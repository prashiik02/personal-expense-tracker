## Personal Expense Tracker

Smart, Indiaâ€‘focused personal expense tracker with:
- **Bank statement ingestion** (UCO, SBI, HDFC, Axis, ICICI, Kotak, PhonePe, SMS)
- **Smart categorization engine** (ML + rules + feedback learning)
- **Rich P2P detection** (UPI/NEFT/IMPS, direction, relationship)

---

## ğŸ”§ Prerequisites

- **Python** 3.10+
- **Node.js** 18+ and **npm**
- **Git** (for cloning)

---

## ğŸš€ Clone the repo

```bash
git clone https://github.com/<your-username>/personal-expense-tracker.git
cd personal-expense-tracker
```

Replace `<your-username>` with your GitHub username.

---

## ğŸ Backend setup

From the project root:

```bash
cd backend
python -m venv .venv
```

Activate the virtualenv:

- **Windows (PowerShell)**:

  ```powershell
  .venv\Scripts\Activate.ps1
  ```

- **macOS/Linux**:

  ```bash
  source .venv/bin/activate
  ```

Install dependencies:

```bash
pip install -r requirements.txt
```

Create a `.env` file in the `backend` folder (minimal example):

```bash
ENV=local
SECRET_KEY=change-me
DEBUG=True
```

Run the backend (adjust if your entry file is different):

```bash
python app.py
```

---

## ğŸ§  Smart Categorization notebook

The demo notebook lives at `backend/smart_categorization/Smart_Categorization_India.ipynb`.

1. Open the notebook in VS Code / Jupyter.
2. Select the **.venv** interpreter you created above.
3. Run all cells to:
   - Initialize `SmartCategorizationPipeline`.
   - See sample Indian transactions categorized.
   - Inspect P2P labels like **â€œUPI Sent â€“ Friends & Familyâ€**, **â€œNEFT Received â€“ Salaryâ€**.

---

## ğŸ¤– LLM categorization with DeepSeek (recommended)

If you want smarter categorization than the built-in ML model, you can enable the **DeepSeek LLM**.
The app will keep using Merchant DB + rules first, and will call the LLM **only when the ML confidence is low**.

### 1) Get a DeepSeek API key

- Sign up and create an API key from the DeepSeek console.

### 2) Configure the backend `.env`

In `backend/.env`:

```env
OLLAMA_ENABLED=true
OLLAMA_URL=http://127.0.0.1:11434  # kept for backwards-compatibility; not used by DeepSeek
OLLAMA_TIMEOUT_S=20
OLLAMA_MIN_CONFIDENCE=0.62

# DeepSeek â€“ do NOT commit real keys
DEEPSEEK_API_KEY=your-deepseek-api-key-here
DEEPSEEK_MODEL=deepseek-chat
DEEPSEEK_BASE_URL=https://api.deepseek.com
```

### 5) Restart the backend

```bash
cd backend
python app.py
```

Now uploads (PDF/CSV/SMS) and categorization requests will automatically use the LLM fallback when needed.

## ğŸ§  Conversational Financial Assistant
Send a POST to `/assistant/query` with a JSON body `{ "question": "How much did I spend on groceries last month?" }` and the backend will answer using your own transaction history. This uses the same DeepSeek LLM that's already configured for parsing.

## ğŸ“„ Monthly Health Reports
GET `/assistant/report?month=2025-12` generates a written summary of spending vs income for a given month. The endpoint also returns the raw aggregates if you want to render tables yourself.

## ğŸ’° Smart Budget Generator
POST `/assistant/budget` analyses the past 3â€¯months of data and returns a suggested budget breakdown. The blueprint currently returns a JSON string from the model but you can extend it store the suggestion in the `budget_suggestions` table.

## ğŸš¨ Anomaly Explainer
POST `/assistant/anomaly/explain` with either `{ "transaction_id": 123 }` or `{ "details": { "date": "2026-01-15", "amount": 789.0, ... } }` returns a human-friendly explanation generated by the LLM. Anomalies are also persisted in the new `anomalies` table.

## ğŸ“‘ Loan Document Analyzer
Upload a loan sanction letter PDF to `/assistant/loan/upload` and the LLM will extract principal, rate, tenure, EMI, etc. The parsed JSON can be stored in `loan_documents` for later querying.

## ğŸ§¾ Tax Saving Suggestions
GET `/assistant/tax/suggestions` returns bulletâ€‘point advice on potential deductions based on your spending.

## ğŸ“± WhatsApp SMS Parser
POST forwarded messages to `/assistant/whatsapp-sms` (same schema as `/categorize/sms`). The service strips common WhatsApp prefixes before feeding the text to the categorization pipeline.

---

## ğŸ“¥ Parsing bank statements

Use the multiâ€‘bank parser + pipeline to process CSV/Excel statements:

```python
from backend.statements.bank_parser import load_and_parse
from backend.smart_categorization.core.pipeline import SmartCategorizationPipeline

# 1. Parse any supported bank statement
parsed = load_and_parse("path/to/statement.csv")  # auto-detects bank from headers

# 2. Initialize pipeline
pipeline = SmartCategorizationPipeline()

# 3. Run full categorization + P2P detection
results = [
    pipeline.process(p.to_pipeline_transaction())
    for p in parsed
]

# Each 'results[i]' contains:
# - category, subcategory
# - is_p2p, p2p_direction, p2p_counterparty, p2p_confidence
# - merchant enrichment, tags, etc.
```

For Excel files (`.xlsx`/`.xls`), `load_and_parse("file.xlsx")` works the same way.

---

## ğŸŒ Frontend (if present)

If this repo has a `frontend` folder:

```bash
cd frontend
npm install
npm run dev
```

Open the URL shown in the terminal (typically `http://localhost:5173`).

---

## âœ… Quick checklist

- [ ] Clone repo and `cd` into it
- [ ] Create & activate Python virtualenv in `backend`
- [ ] `pip install -r requirements.txt`
- [ ] Create `backend/.env`
- [ ] Run `python app.py`
- [ ] (Optional) Run the notebook `Smart_Categorization_India.ipynb`
- [ ] (Optional) Start frontend with `npm run dev`
